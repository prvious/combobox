function d(c){return c==null||c===""||typeof c=="string"&&c.trim()===""}function r(c){return!d(c)}var V=class{constructor({element:t,options:e,placeholder:i,state:s,canOptionLabelsWrap:o=!0,canSelectPlaceholder:n=!0,initialOptionLabel:a=null,initialOptionLabels:l=null,initialState:h=null,isHtmlAllowed:p=!1,isAutofocused:f=!1,isDisabled:g=!1,isMultiple:y=!1,isSearchable:L=!1,getOptionLabelUsing:O=null,getOptionLabelsUsing:S=null,getOptionsUsing:I=null,getSearchResultsUsing:x=null,hasDynamicOptions:v=!1,hasDynamicSearchResults:A=!0,searchPrompt:C="Search...",searchDebounce:w=1e3,loadingMessage:D="Loading...",searchingMessage:E="Searching...",noSearchResultsMessage:R="No results found",maxItems:M=null,maxItemsMessage:k="Maximum number of items selected",optionsLimit:N=null,searchableOptionFields:b=["label"],searchQuery:m=null,autoSearch:T=!1,livewireId:u=null,statePath:B=null,onStateChange:U=()=>{}}){this.element=t,this.options=e,this.originalOptions=JSON.parse(JSON.stringify(e)),this.placeholder=i,this.state=s,this.canOptionLabelsWrap=o,this.canSelectPlaceholder=n,this.initialOptionLabel=a,this.initialOptionLabels=l,this.initialState=h,this.isHtmlAllowed=p,this.isAutofocused=f,this.isDisabled=g,this.isMultiple=y,this.isSearchable=L,this.getOptionLabelUsing=O,this.getOptionLabelsUsing=S,this.getOptionsUsing=I,this.getSearchResultsUsing=x,this.hasDynamicOptions=v,this.hasDynamicSearchResults=A,this.searchPrompt=C,this.searchDebounce=w,this.loadingMessage=D,this.searchingMessage=E,this.noSearchResultsMessage=R,this.maxItems=M,this.maxItemsMessage=k,this.optionsLimit=N,this.searchableOptionFields=Array.isArray(b)?b:["label"],this.initialSearchQuery=m,this.autoSearch=T,this.livewireId=u,this.statePath=B,this.onStateChange=U,this.labelRepository={},this.selectedIndex=-1,this.searchQuery=m||"",this.searchTimeout=null,this.isSearching=!1,this.selectedDisplayVersion=0,this.render(),this.setUpEventListeners(),this.isAutofocused&&this.searchInput&&this.searchInput.focus(),this.autoSearch&&r(this.initialSearchQuery)&&this.performInitialSearch()}populateLabelRepositoryFromOptions(t){if(!(!t||!Array.isArray(t)))for(let e of t)e.options&&Array.isArray(e.options)?this.populateLabelRepositoryFromOptions(e.options):e.value!==void 0&&e.label!==void 0&&(this.labelRepository[e.value]=e.label)}render(){this.populateLabelRepositoryFromOptions(this.options),this.container=document.createElement("div"),this.container.className="prvious-combobox-input-ctn",this.canOptionLabelsWrap||this.container.classList.add("prvious-combobox-input-ctn-option-labels-not-wrapped"),this.isMultiple&&(this.selectedDisplay=document.createElement("div"),this.selectedDisplay.className="prvious-combobox-input-value-ctn",this.container.appendChild(this.selectedDisplay)),this.searchContainer=document.createElement("div"),this.searchContainer.className="prvious-combobox-input-search-ctn";let t=document.createElement("span");t.className="prvious-combobox-search-icon",t.innerHTML='<svg class="fi-icon fi-size-md" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg>',this.searchContainer.appendChild(t),this.searchInput=document.createElement("input"),this.searchInput.className="fi-input prvious-combobox-unified-input",this.searchInput.type="text",this.searchInput.setAttribute("aria-label","Search"),this.searchQuery&&(this.searchInput.value=this.searchQuery),this.searchContainer.appendChild(this.searchInput),this.container.appendChild(this.searchContainer),this.updateSelectedDisplay(),this.optionsContainer=document.createElement("div"),this.optionsContainer.className="prvious-combobox-options-wrapper max-h-60 overflow-y-auto",this.optionsContainer.setAttribute("role","listbox"),this.optionsContainer.setAttribute("tabindex","-1"),this.isMultiple&&this.optionsContainer.setAttribute("aria-multiselectable","true"),this.optionsList=document.createElement("ul"),this.renderOptions(),this.optionsContainer.appendChild(this.optionsList),this.container.appendChild(this.optionsContainer),this.element.appendChild(this.container),this.applyDisabledState(),this.hasDynamicOptions&&this.getOptionsUsing&&this.loadDynamicOptions()}async loadDynamicOptions(){this.showLoadingState(!1);try{let t=await this.getOptionsUsing(),e=Array.isArray(t)?t:t&&Array.isArray(t.options)?t.options:[];this.options=e,this.originalOptions=JSON.parse(JSON.stringify(e)),this.populateLabelRepositoryFromOptions(e),this.renderOptions()}catch(t){console.error("Error fetching options:",t),this.hideLoadingState()}}async performInitialSearch(){if(!this.isSearchable||!this.searchInput)return;let t=this.initialSearchQuery;if(r(t)){if(this.searchQuery=t,this.searchInput.value=t,!this.getSearchResultsUsing||typeof this.getSearchResultsUsing!="function"||!this.hasDynamicSearchResults){this.filterOptions(t.trim().toLowerCase());return}this.isSearching=!0;try{this.showLoadingState(!0);let e=await this.getSearchResultsUsing(t),i=Array.isArray(e)?e:e&&Array.isArray(e.options)?e.options:[];this.options=i,this.populateLabelRepositoryFromOptions(i),this.hideLoadingState(),this.renderOptions(),this.options.length===0&&this.showNoResultsMessage()}catch(e){console.error("Error fetching initial search results:",e),this.hideLoadingState(),this.options=JSON.parse(JSON.stringify(this.originalOptions)),this.renderOptions()}finally{this.isSearching=!1}}}renderOptions(){this.optionsList.innerHTML="";let t=0,e=this.options,i=0,s=!1;this.options.forEach(a=>{a.options&&Array.isArray(a.options)?(i+=a.options.length,s=!0):i++}),s?this.optionsList.className="prvious-combobox-input-options-ctn":i>0&&(this.optionsList.className="fi-dropdown-list");let o=s?null:this.optionsList,n=0;for(let a of e){if(this.optionsLimit&&n>=this.optionsLimit)break;if(a.options&&Array.isArray(a.options)){let l=a.options;if(this.isMultiple&&Array.isArray(this.state)&&this.state.length>0&&(l=a.options.filter(h=>!this.state.includes(h.value))),l.length>0){if(this.optionsLimit){let h=this.optionsLimit-n;h<l.length&&(l=l.slice(0,h))}this.renderOptionGroup(a.label,l),n+=l.length,t+=l.length}}else{if(this.isMultiple&&Array.isArray(this.state)&&this.state.includes(a.value))continue;!o&&s&&(o=document.createElement("ul"),o.className="fi-dropdown-list",this.optionsList.appendChild(o));let l=this.createOptionElement(a.value,a);o.appendChild(l),n++,t++}}t===0?(this.searchQuery&&this.showNoResultsMessage(),this.optionsList.parentNode===this.optionsContainer&&this.optionsContainer.removeChild(this.optionsList)):(this.hideLoadingState(),this.optionsList.parentNode!==this.optionsContainer&&this.optionsContainer.appendChild(this.optionsList))}renderOptionGroup(t,e){if(e.length===0)return;let i=document.createElement("li");i.className="prvious-combobox-input-option-group";let s=document.createElement("div");s.className="fi-dropdown-header",s.textContent=t;let o=document.createElement("ul");o.className="fi-dropdown-list",e.forEach(n=>{let a=this.createOptionElement(n.value,n);o.appendChild(a)}),i.appendChild(s),i.appendChild(o),this.optionsList.appendChild(i)}createOptionElement(t,e){let i=t,s=e,o=!1;typeof e=="object"&&e!==null&&"label"in e&&"value"in e&&(i=e.value,s=e.label,o=e.isDisabled||!1);let n=document.createElement("li");n.className="fi-dropdown-list-item prvious-combobox-input-option",o&&n.classList.add("fi-disabled");let a=`prvious-combobox-input-option-${Math.random().toString(36).substring(2,11)}`;if(n.id=a,n.setAttribute("role","option"),n.setAttribute("data-value",i),n.setAttribute("tabindex","0"),o&&n.setAttribute("aria-disabled","true"),this.isHtmlAllowed&&typeof s=="string"){let p=document.createElement("div");p.innerHTML=s;let f=p.textContent||p.innerText||s;n.setAttribute("aria-label",f)}let l=this.isMultiple?Array.isArray(this.state)&&this.state.includes(i):this.state===i;n.setAttribute("aria-selected",l?"true":"false"),l&&n.classList.add("fi-selected");let h=document.createElement("span");return this.isHtmlAllowed?h.innerHTML=s:h.textContent=s,n.appendChild(h),o||n.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),this.selectOption(i),this.isMultiple&&(this.isSearchable&&this.searchInput?setTimeout(()=>{this.searchInput.focus()},0):setTimeout(()=>{n.focus()},0))}),n}async updateSelectedDisplay(){this.selectedDisplayVersion=this.selectedDisplayVersion+1;let t=this.selectedDisplayVersion;if(!this.searchInput)return;if(this.isMultiple){let i=document.createDocumentFragment();if(!Array.isArray(this.state)||this.state.length===0)this.searchInput.placeholder=this.placeholder,this.selectedDisplay&&this.selectedDisplay.replaceChildren(i);else{let s=await this.getLabelsForMultipleSelection();if(t!==this.selectedDisplayVersion)return;this.addBadgesForSelectedOptions(s,i),this.searchInput.placeholder=this.searchPrompt,t===this.selectedDisplayVersion&&this.selectedDisplay&&this.selectedDisplay.replaceChildren(i)}return}if(this.state===null||this.state===""){this.searchInput.placeholder=this.placeholder,this.searchQuery||(this.searchInput.value="");return}let e=await this.getLabelForSingleSelection();if(t===this.selectedDisplayVersion&&!this.searchQuery)if(this.isHtmlAllowed){let i=document.createElement("div");i.innerHTML=e,this.searchInput.placeholder=i.textContent||i.innerText||""}else this.searchInput.placeholder=e}async getLabelsForMultipleSelection(){let t=this.getSelectedOptionLabels(),e=[];if(Array.isArray(this.state)){for(let s of this.state)if(!r(this.labelRepository[s])){if(r(t[s])){this.labelRepository[s]=t[s];continue}e.push(s.toString())}}if(e.length>0&&r(this.initialOptionLabels)&&JSON.stringify(this.state)===JSON.stringify(this.initialState)){if(Array.isArray(this.initialOptionLabels))for(let s of this.initialOptionLabels)r(s)&&s.value!==void 0&&s.label!==void 0&&e.includes(s.value)&&(this.labelRepository[s.value]=s.label)}else if(e.length>0&&this.getOptionLabelsUsing)try{let s=await this.getOptionLabelsUsing();for(let o of s)r(o)&&o.value!==void 0&&o.label!==void 0&&(this.labelRepository[o.value]=o.label)}catch(s){console.error("Error fetching option labels:",s)}let i=[];if(Array.isArray(this.state))for(let s of this.state)r(this.labelRepository[s])?i.push(this.labelRepository[s]):r(t[s])?i.push(t[s]):i.push(s);return i}createBadgeElement(t,e){let i=document.createElement("span");i.className="fi-badge fi-size-md fi-color fi-color-primary fi-text-color-600 dark:fi-text-color-200",r(t)&&i.setAttribute("data-value",t);let s=document.createElement("span");s.className="fi-badge-label-ctn";let o=document.createElement("span");o.className="fi-badge-label",this.canOptionLabelsWrap&&o.classList.add("fi-wrapped"),this.isHtmlAllowed?o.innerHTML=e:o.textContent=e,s.appendChild(o),i.appendChild(s);let n=this.createRemoveButton(t,e);return i.appendChild(n),i}createRemoveButton(t,e){let i=document.createElement("button");return i.type="button",i.className="fi-badge-delete-btn",i.innerHTML='<svg class="fi-icon fi-size-xs" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',i.setAttribute("aria-label","Remove "+(this.isHtmlAllowed?e.replace(/<[^>]*>/g,""):e)),i.addEventListener("click",s=>{s.stopPropagation(),r(t)&&this.selectOption(t)}),i.addEventListener("keydown",s=>{(s.key===" "||s.key==="Enter")&&(s.preventDefault(),s.stopPropagation(),r(t)&&this.selectOption(t))}),i}addBadgesForSelectedOptions(t,e=this.selectedDisplay){let i=document.createElement("div");i.className="prvious-combobox-input-value-badges-ctn",t.forEach((s,o)=>{let n=Array.isArray(this.state)?this.state[o]:null,a=this.createBadgeElement(n,s);i.appendChild(a)}),e.appendChild(i)}async getLabelForSingleSelection(){let t=this.labelRepository[this.state];if(d(t)&&(t=this.getSelectedOptionLabel(this.state)),d(t)&&r(this.initialOptionLabel)&&this.state===this.initialState)t=this.initialOptionLabel,r(this.state)&&(this.labelRepository[this.state]=t);else if(d(t)&&this.getOptionLabelUsing)try{t=await this.getOptionLabelUsing(),r(t)&&r(this.state)&&(this.labelRepository[this.state]=t)}catch(e){console.error("Error fetching option label:",e),t=this.state}else d(t)&&(t=this.state);return t}addSingleSelectionDisplay(t,e=this.selectedDisplay){let i=document.createElement("span");if(i.className="prvious-combobox-input-value-label",this.isHtmlAllowed?i.innerHTML=t:i.textContent=t,e.appendChild(i),!this.canSelectPlaceholder)return;let s=document.createElement("button");s.type="button",s.className="prvious-combobox-input-value-remove-btn",s.innerHTML='<svg class="fi-icon fi-size-sm" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>',s.setAttribute("aria-label","Clear selection"),s.addEventListener("click",o=>{o.stopPropagation(),this.selectOption("")}),s.addEventListener("keydown",o=>{(o.key===" "||o.key==="Enter")&&(o.preventDefault(),o.stopPropagation(),this.selectOption(""))}),e.appendChild(s)}getSelectedOptionLabel(t){if(r(this.labelRepository[t]))return this.labelRepository[t];let e="";for(let i of this.options)if(i.options&&Array.isArray(i.options)){for(let s of i.options)if(s.value===t){e=s.label,this.labelRepository[t]=e;break}}else if(i.value===t){e=i.label,this.labelRepository[t]=e;break}return e}setUpEventListeners(){this.isSearchable&&this.searchInput&&(this.searchInput.addEventListener("input",t=>{this.isDisabled||this.handleSearch(t)}),this.searchInput.addEventListener("keydown",t=>{if(!this.isDisabled){if(t.key==="Tab"){t.preventDefault();let e=this.getVisibleOptions();if(e.length===0)return;t.shiftKey?this.selectedIndex=e.length-1:this.selectedIndex=0,e.forEach(i=>{i.classList.remove("fi-selected")}),e[this.selectedIndex].classList.add("fi-selected"),e[this.selectedIndex].focus()}else if(t.key==="ArrowDown"){if(t.preventDefault(),t.stopPropagation(),this.getVisibleOptions().length===0)return;this.selectedIndex=-1,this.searchInput.blur(),this.focusNextOption()}else if(t.key==="ArrowUp"){t.preventDefault(),t.stopPropagation();let e=this.getVisibleOptions();if(e.length===0)return;this.selectedIndex=e.length-1,this.searchInput.blur(),e[this.selectedIndex].classList.add("fi-selected"),e[this.selectedIndex].focus(),e[this.selectedIndex].id&&this.optionsContainer.setAttribute("aria-activedescendant",e[this.selectedIndex].id),this.scrollOptionIntoView(e[this.selectedIndex])}else if(t.key==="Enter"){if(t.preventDefault(),t.stopPropagation(),this.isSearching)return;let e=this.getVisibleOptions();if(e.length===0)return;let i=e.find(o=>{let n=o.getAttribute("aria-disabled")==="true",a=o.classList.contains("fi-disabled"),l=o.offsetParent===null;return!(n||a||l)});if(!i)return;let s=i.getAttribute("data-value");if(s===null)return;this.selectOption(s)}}})),this.optionsContainerKeydownListener=t=>{this.isDisabled||this.isSearchable&&document.activeElement===this.searchInput&&!["Tab","Escape"].includes(t.key)||this.handleOptionsKeydown(t)},this.optionsContainer.addEventListener("keydown",this.optionsContainerKeydownListener),!this.isMultiple&&this.livewireId&&this.statePath&&this.getOptionLabelUsing&&(this.refreshOptionLabelListener=async t=>{if(t.detail.livewireId===this.livewireId&&t.detail.statePath===this.statePath&&r(this.state))try{delete this.labelRepository[this.state];let e=await this.getOptionLabelUsing();r(e)&&(this.labelRepository[this.state]=e);let i=this.selectedDisplay.querySelector(".prvious-combobox-input-value-label");r(i)&&(this.isHtmlAllowed?i.innerHTML=e:i.textContent=e),this.updateOptionLabelInList(this.state,e)}catch(e){console.error("Error refreshing option label:",e)}},window.addEventListener("filament-forms::select.refreshSelectedOptionLabel",this.refreshOptionLabelListener))}updateOptionLabelInList(t,e){this.labelRepository[t]=e;let i=this.getVisibleOptions();for(let s of i)if(s.getAttribute("data-value")===String(t)){if(s.innerHTML="",this.isHtmlAllowed){let o=document.createElement("span");o.innerHTML=e,s.appendChild(o)}else s.appendChild(document.createTextNode(e));break}for(let s of this.options)if(s.options&&Array.isArray(s.options)){for(let o of s.options)if(o.value===t){o.label=e;break}}else if(s.value===t){s.label=e;break}for(let s of this.originalOptions)if(s.options&&Array.isArray(s.options)){for(let o of s.options)if(o.value===t){o.label=e;break}}else if(s.value===t){s.label=e;break}}handleOptionsKeydown(t){switch(t.key){case"ArrowDown":t.preventDefault(),t.stopPropagation(),this.focusNextOption();break;case"ArrowUp":t.preventDefault(),t.stopPropagation(),this.focusPreviousOption();break;case" ":if(t.preventDefault(),this.selectedIndex>=0){let e=this.getVisibleOptions()[this.selectedIndex];e&&e.click()}break;case"Enter":if(t.preventDefault(),this.selectedIndex>=0){let e=this.getVisibleOptions()[this.selectedIndex];e&&e.click()}break;case"Tab":break;default:if(this.isSearchable&&!t.ctrlKey&&!t.metaKey&&!t.altKey&&typeof t.key=="string"&&t.key.length===1){t.preventDefault();let e=t.key;this.searchInput&&(this.searchInput.focus(),this.searchInput.value=(this.searchInput.value||"")+e,this.searchInput.dispatchEvent(new Event("input",{bubbles:!0})))}break}}focusNextOption(){let t=this.getVisibleOptions();if(t.length!==0){if(this.selectedIndex>=0&&this.selectedIndex<t.length&&t[this.selectedIndex].classList.remove("fi-selected"),this.selectedIndex===t.length-1&&this.isSearchable&&this.searchInput){this.selectedIndex=-1,this.searchInput.focus(),this.optionsContainer.removeAttribute("aria-activedescendant");return}this.selectedIndex=(this.selectedIndex+1)%t.length,t[this.selectedIndex].classList.add("fi-selected"),t[this.selectedIndex].focus(),t[this.selectedIndex].id&&this.optionsContainer.setAttribute("aria-activedescendant",t[this.selectedIndex].id),this.scrollOptionIntoView(t[this.selectedIndex])}}focusPreviousOption(){let t=this.getVisibleOptions();if(t.length!==0){if(this.selectedIndex>=0&&this.selectedIndex<t.length&&t[this.selectedIndex].classList.remove("fi-selected"),(this.selectedIndex===0||this.selectedIndex===-1)&&this.isSearchable&&this.searchInput){this.selectedIndex=-1,this.searchInput.focus(),this.optionsContainer.removeAttribute("aria-activedescendant");return}this.selectedIndex=(this.selectedIndex-1+t.length)%t.length,t[this.selectedIndex].classList.add("fi-selected"),t[this.selectedIndex].focus(),t[this.selectedIndex].id&&this.optionsContainer.setAttribute("aria-activedescendant",t[this.selectedIndex].id),this.scrollOptionIntoView(t[this.selectedIndex])}}scrollOptionIntoView(t){if(!t)return;let e=this.optionsContainer.getBoundingClientRect(),i=t.getBoundingClientRect();i.bottom>e.bottom?this.optionsContainer.scrollTop+=i.bottom-e.bottom:i.top<e.top&&(this.optionsContainer.scrollTop-=e.top-i.top)}getVisibleOptions(){let t=[];this.optionsList.classList.contains("fi-dropdown-list")?t=Array.from(this.optionsList.querySelectorAll(':scope > li[role="option"]')):t=Array.from(this.optionsList.querySelectorAll(':scope > ul.fi-dropdown-list > li[role="option"]'));let e=Array.from(this.optionsList.querySelectorAll('li.prvious-combobox-input-option-group > ul > li[role="option"]'));return[...t,...e]}getSelectedOptionLabels(){if(!Array.isArray(this.state)||this.state.length===0)return{};let t={};for(let e of this.state){let i=!1;for(let s of this.options)if(s.options&&Array.isArray(s.options)){for(let o of s.options)if(o.value===e){t[e]=o.label,i=!0;break}if(i)break}else if(s.value===e){t[e]=s.label,i=!0;break}}return t}handleSearch(t){let e=t.target.value.trim().toLowerCase();if(this.searchQuery=e,this.searchTimeout&&clearTimeout(this.searchTimeout),e===""){this.options=JSON.parse(JSON.stringify(this.originalOptions)),this.renderOptions();return}if(!this.getSearchResultsUsing||typeof this.getSearchResultsUsing!="function"||!this.hasDynamicSearchResults){this.filterOptions(e);return}this.searchTimeout=setTimeout(async()=>{this.searchTimeout=null,this.isSearching=!0;try{this.showLoadingState(!0);let i=await this.getSearchResultsUsing(e),s=Array.isArray(i)?i:i&&Array.isArray(i.options)?i.options:[];this.options=s,this.populateLabelRepositoryFromOptions(s),this.hideLoadingState(),this.renderOptions(),this.options.length===0&&this.showNoResultsMessage()}catch(i){console.error("Error fetching search results:",i),this.hideLoadingState(),this.options=JSON.parse(JSON.stringify(this.originalOptions)),this.renderOptions()}finally{this.isSearching=!1}},this.searchDebounce)}showLoadingState(t=!1){this.optionsList.parentNode===this.optionsContainer&&this.optionsContainer.removeChild(this.optionsList),this.hideLoadingState();let e=document.createElement("div");e.className="prvious-combobox-input-message",e.textContent=t?this.searchingMessage:this.loadingMessage,this.optionsContainer.appendChild(e)}hideLoadingState(){let t=this.optionsContainer.querySelector(".prvious-combobox-input-message");t&&t.remove()}showNoResultsMessage(){this.optionsList.parentNode===this.optionsContainer&&this.optionsContainer.removeChild(this.optionsList),this.hideLoadingState();let t=document.createElement("div");t.className="prvious-combobox-input-message",t.textContent=this.noSearchResultsMessage,this.optionsContainer.appendChild(t)}filterOptions(t){let e=this.searchableOptionFields.includes("label"),i=this.searchableOptionFields.includes("value"),s=[];for(let o of this.originalOptions)if(o.options&&Array.isArray(o.options)){let n=o.options.filter(a=>e&&a.label.toLowerCase().includes(t)||i&&String(a.value).toLowerCase().includes(t));n.length>0&&s.push({label:o.label,options:n})}else(e&&o.label.toLowerCase().includes(t)||i&&String(o.value).toLowerCase().includes(t))&&s.push(o);this.options=s,this.renderOptions(),this.options.length===0&&this.showNoResultsMessage()}selectOption(t){if(this.isDisabled)return;if(!this.isMultiple){this.state=t,this.updateSelectedDisplay(),this.renderOptions(),this.onStateChange(this.state);return}let e=Array.isArray(this.state)?[...this.state]:[];if(e.includes(t)){let s=this.selectedDisplay.querySelector(`[data-value="${t}"]`);if(r(s)){let o=s.parentElement;r(o)&&o.children.length===1?(e=e.filter(n=>n!==t),this.state=e,this.updateSelectedDisplay()):(s.remove(),e=e.filter(n=>n!==t),this.state=e)}else e=e.filter(o=>o!==t),this.state=e,this.updateSelectedDisplay();this.renderOptions(),this.maintainFocusInMultipleMode(),this.onStateChange(this.state);return}if(this.maxItems&&e.length>=this.maxItems){this.maxItemsMessage&&alert(this.maxItemsMessage);return}e.push(t),this.state=e;let i=this.selectedDisplay.querySelector(".prvious-combobox-input-value-badges-ctn");d(i)?this.updateSelectedDisplay():this.addSingleBadge(t,i),this.renderOptions(),this.maintainFocusInMultipleMode(),this.onStateChange(this.state)}async addSingleBadge(t,e){let i=this.labelRepository[t];if(d(i)&&(i=this.getSelectedOptionLabel(t),r(i)&&(this.labelRepository[t]=i)),d(i)&&this.getOptionLabelsUsing)try{let o=await this.getOptionLabelsUsing();for(let n of o)if(r(n)&&n.value===t&&n.label!==void 0){i=n.label,this.labelRepository[t]=i;break}}catch(o){console.error("Error fetching option label:",o)}d(i)&&(i=t);let s=this.createBadgeElement(t,i);e.appendChild(s)}maintainFocusInMultipleMode(){if(this.isSearchable&&this.searchInput){this.searchInput.focus();return}let t=this.getVisibleOptions();if(t.length!==0){if(this.selectedIndex=-1,Array.isArray(this.state)&&this.state.length>0){for(let e=0;e<t.length;e++)if(this.state.includes(t[e].getAttribute("data-value"))){this.selectedIndex=e;break}}this.selectedIndex===-1&&(this.selectedIndex=0),t[this.selectedIndex].classList.add("fi-selected"),t[this.selectedIndex].focus()}}disable(){this.isDisabled||(this.isDisabled=!0,this.applyDisabledState())}enable(){this.isDisabled&&(this.isDisabled=!1,this.applyDisabledState())}applyDisabledState(){if(this.isDisabled){if(this.container.classList.add("fi-disabled"),this.isMultiple&&this.container.querySelectorAll(".fi-badge-delete-btn").forEach(e=>{e.setAttribute("disabled","disabled"),e.classList.add("fi-disabled")}),!this.isMultiple&&this.canSelectPlaceholder){let t=this.container.querySelector(".prvious-combobox-input-value-remove-btn");t&&(t.setAttribute("disabled","disabled"),t.classList.add("fi-disabled"))}this.isSearchable&&this.searchInput&&(this.searchInput.setAttribute("disabled","disabled"),this.searchInput.classList.add("fi-disabled"))}else{if(this.container.classList.remove("fi-disabled"),this.isMultiple&&this.container.querySelectorAll(".fi-badge-delete-btn").forEach(e=>{e.removeAttribute("disabled"),e.classList.remove("fi-disabled")}),!this.isMultiple&&this.canSelectPlaceholder){let t=this.container.querySelector(".prvious-combobox-input-value-remove-btn");t&&(t.removeAttribute("disabled"),t.classList.remove("fi-disabled"))}this.isSearchable&&this.searchInput&&(this.searchInput.removeAttribute("disabled"),this.searchInput.classList.remove("fi-disabled"))}}destroy(){this.searchInput&&this.searchInput.removeEventListener("input",this.handleSearch),this.optionsContainer&&this.optionsContainerKeydownListener&&this.optionsContainer.removeEventListener("keydown",this.optionsContainerKeydownListener),this.refreshOptionLabelListener&&window.removeEventListener("filament-forms::select.refreshSelectedOptionLabel",this.refreshOptionLabelListener),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.container&&this.container.remove()}};function P({canOptionLabelsWrap:c,canSelectPlaceholder:t,isHtmlAllowed:e,getOptionLabelUsing:i,getOptionLabelsUsing:s,getOptionsUsing:o,getSearchResultsUsing:n,initialOptionLabel:a,initialOptionLabels:l,initialState:h,isAutofocused:p,isDisabled:f,isMultiple:g,isSearchable:y,hasDynamicOptions:L,hasDynamicSearchResults:O,livewireId:S,loadingMessage:I,maxItems:x,maxItemsMessage:v,noSearchResultsMessage:A,options:C,optionsLimit:w,placeholder:D,searchDebounce:E,searchingMessage:R,searchPrompt:M,searchableOptionFields:k,searchQuery:N,autoSearch:b,state:m,statePath:T}){return{combobox:null,state:m,init(){this.combobox=new V({element:this.$refs.combobox,options:C,placeholder:D,state:this.state,canOptionLabelsWrap:c,canSelectPlaceholder:t,initialOptionLabel:a,initialOptionLabels:l,initialState:h,isHtmlAllowed:e,isAutofocused:p,isDisabled:f,isMultiple:g,isSearchable:y,getOptionLabelUsing:i,getOptionLabelsUsing:s,getOptionsUsing:o,getSearchResultsUsing:n,hasDynamicOptions:L,hasDynamicSearchResults:O,searchPrompt:M,searchDebounce:E,loadingMessage:I,searchingMessage:R,noSearchResultsMessage:A,maxItems:x,maxItemsMessage:v,optionsLimit:w,searchableOptionFields:k,searchQuery:N,autoSearch:b,livewireId:S,statePath:T,onStateChange:u=>{this.state=u}}),this.$watch("state",u=>{this.combobox&&this.combobox.state!==u&&(this.combobox.state=u,this.combobox.updateSelectedDisplay(),this.combobox.renderOptions())})},destroy(){this.combobox&&(this.combobox.destroy(),this.combobox=null)}}}export{P as default};
